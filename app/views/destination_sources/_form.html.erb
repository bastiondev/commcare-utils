<%= form_with(model: [@destination, @destination_source], local: true) do |form| %>
  <% if @destination_source.errors.any? %>
    <div class="alert alert-danger" role="alert">
      <h4 class="alert-heading"><%= pluralize(@destination_source.errors.count, "error") %> prohibited this source from being saved:</h4>
      <ul class="mb-0">
        <% @destination_source.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="row">
    <div class="col-lg-3 mb-3">
      <%= form.label :name, class: 'form-label form-label-sm' %>
      <%= form.text_field :name, class: 'form-control form-control-sm', required: true %>
    </div>

    <div class="col-lg-3 mb-3">
      <%= form.label :case_type, class: 'form-label form-label-sm' %>
      <%= form.text_field :case_type, class: 'form-control form-control-sm' %>
    </div>

    <div class="col-lg-3 mb-3">
      <%= form.label :key_column, class: 'form-label form-label-sm' %>
      <%= form.text_field :key_column, class: 'form-control form-control-sm', required: true %>
    </div>

    <div class="col-lg-3 mb-3">
      <%= form.label :table_name, class: 'form-label form-label-sm' %>
      <%= form.text_field :table_name, class: 'form-control form-control-sm', required: true %>
    </div>
  </div>

  <div class="row">
    <div class="col-12 col-lg-12 mb-3">
      <%= form.label :sensitive_fields, class: 'form-label form-label-sm' %>
      <%= form.text_area :sensitive_fields, class: 'form-control form-control-sm', rows: 2, placeholder: 'Comma-separated list of sensitive fields', value: @destination_source.sensitive_fields || ENV['DEFAULT_SENSITIVE_FIELDS'] %>
    </div>
  </div>

  <div class="row">

    <div class="col-lg-9 mb-3">
      <%= form.label :url, class: 'form-label form-label-sm' %>
      <%= form.text_field :url, class: 'form-control form-control-sm' %>
      <small class="form-text text-muted">Optional. Only used for Excel Dashboard Integration, not data forwarding.</small>
    </div>
    <div class="col-lg-3 mb-3">
      <%= form.label :scheduled_sync, 'Sync', class: 'form-label form-label-sm' %>
      <div class="form-check">
        <%= form.check_box :scheduled_sync, class: 'form-check-input' %>
        <%= form.label :scheduled_sync, 'Enable daily sync', class: 'form-check-label' %>
      </div>
    </div>
  </div>

  <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
    <%= form.submit class: 'btn btn-outline-primary' %>
    <%= link_to 'Cancel', destination_path(@destination), class: 'btn btn-outline-secondary' %>
  </div>
<% end %>
